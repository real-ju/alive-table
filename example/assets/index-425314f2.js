import{d as L,r as k,c as $,o as w,a as S,b as v,w as i,u as b,T as D,m as N,e as T,f as M,t as J,g as K,F as E,h as G,i as x,j as q,k as Q,I as A,l as H,S as U,_ as V,n as r,p as j,q as F}from"./index-38a63314.js";const W={key:0,class:"editable-table"},X=L({__name:"index",props:{tableProps:{type:Object,default:null},rules:{type:Object,default:null}},setup(s,{expose:y}){const _={input:A,"input-number":H,select:U},h=s,p=k(),z=$(()=>{const n=h.tableProps.scroll;return n?(n.y=0,n):{y:0}}),c=$(()=>h.rules?new Array(h.tableProps.dataSource.length).fill(h.rules):null);return y({formRef:p}),(n,f)=>s.tableProps&&s.tableProps.columns&&s.tableProps.dataSource?(w(),S("div",W,[v(b(q),{ref_key:"formRef",ref:p,autocomplete:"off",model:s.tableProps.dataSource,rules:b(c)},{default:i(()=>[v(b(D),N(h.tableProps,{pagination:!1,bordered:"",scroll:b(z)}),{bodyCell:i(({column:t,record:l,index:e})=>[t.key&&t.editComp?(w(),T(b(E),{key:0,name:[e,t.key]},{default:i(()=>[(w(),T(M(_[t.editComp.type]),N({value:l[t.key],"onUpdate:value":a=>l[t.key]=a},t.editComp.props||{},J(t.editComp.on||{})),{default:i(()=>[K(n.$slots,`col-${t.key}-comp-slot`,{},void 0,!0)]),_:2},1040,["value","onUpdate:value"]))]),_:2},1032,["name"])):(w(),S(G,{key:1},[x("请指定column.key和column.editComp")],64))]),_:3},16,["scroll"])]),_:3},8,["model","rules"])])):Q("",!0)}});const Y=V(X,[["__scopeId","data-v-a3f6a41f"]]),Z={input:A,"input-number":H,select:U},ee=L({name:"AliveTable",props:{schema:{type:Object,default:null},model:{type:Object,default:null},rules:{type:Object,default:null}},setup(s,{slots:y,expose:_}){const h=t=>t.map(l=>{const e={cell:l.content.type!=="slot","custom-cell":!0};l.key&&(e[l.key]=!0);const a=y[`custom-cell-${l.key}-slot`];return r("div",{class:e,style:{flex:l.width?"none":null,width:l.width?l.width:null}},l.content.type==="string"?l.content.text:a&&a())});let p=[];const z=(t,l)=>(l||(p=[]),t.map(e=>{if(e.type==="field"){if(!e.key&&!e.keyPath)throw"存在field没有指定key或keyPath";if(!e.keyPath&&l&&!l.key)throw"存在field-group没有指定key";e.keyPath||(l?e.keyPath=l.keyPath+"."+e.key:e.keyPath=e.key);const a=e.keyPath.split(".");let u=s.model;a.forEach((o,d)=>{d<a.length-1&&Reflect.has(u,o)&&(u=u[o])});const R=a[a.length-1];let m;const I={};if(Object.keys(y).forEach(o=>{if(o.includes(`field-${e.key}-comp-slot`))if(o===`field-${e.key}-comp-slot`||o===`field-${e.key}-comp-slot-default`)I.default=y[o];else{const d=o.split("-"),C=d[d.length-1];I[C]=y[o]}}),e.value.type==="string")m=r("span",null,e.value.content||"");else if(e.value.type==="input"||e.value.type==="input-number"||e.value.type==="select")m=r(E,{name:a},()=>r(Z[e.value.type],{value:u[R],"onUpdate:value":o=>{u[R]=o},...e.value.compProps},I));else if(e.value.type==="slot"){const o=y[`field-${e.key}-slot`];m=o&&o()}else if(e.value.type==="editable-table"){const o=k();p.push(o);let d=s.rules;if(s.rules)for(let g=0;g<a.length;g++){const P=a[g];if(Reflect.has(d,P))d=d[P];else{d=null;break}}const C={};Object.keys(y).forEach(g=>{if(g.includes(`table-${e.key}-col-`)){const P=g.split("-"),B=P[P.length-3];C[`col-${B}-comp-slot`]=y[g]}}),m=r(Y,{ref:o,tableProps:{...e.value.compProps,dataSource:u[R]},rules:d},C)}const O=[r("div",{class:{cell:e.value.type==="string",value:!0,slot:e.value.type==="slot"},style:{flex:e.value.size?"none":null,width:e.layout==="horizontal"&&e.value.size?e.value.size:null,height:e.layout==="vertical"&&e.value.size?e.value.size:null,border:e.label?null:"none"}},m)];return e.label&&O.unshift(r("div",{class:"cell label",style:{flex:e.label.size?"none":null,width:e.layout==="horizontal"&&e.label.size?e.label.size:null,height:e.layout==="vertical"&&e.label.size?e.label.size:null}},e.name||"")),r("div",{class:{row:!l,field:!0,[e.key||e.keyPath]:!0,vertical:e.layout==="vertical"},style:{flex:e.size||l&&l.contentLayout==="float"?"none":null,width:l&&l.contentLayout==="horizontal"&&e.size?e.size:l&&l.contentLayout==="float"&&e.width?e.width:null,height:!l||l.contentLayout==="vertical"&&e.size?e.size:l&&l.contentLayout==="float"&&e.height?e.height:null}},O)}else if(e.type==="field-group"){e.key&&(l?e.keyPath=l.keyPath+"."+e.key:e.keyPath=e.key);const a=[r("div",{class:{content:!0,vertical:e.contentLayout==="vertical",float:e.contentLayout==="float"},style:{border:e.label?null:"none"}},z(e.children,e))];e.label&&a.unshift(r("div",{class:"cell label",style:{flex:e.label.size?"none":null,width:e.layout==="horizontal"&&e.label.size?e.label.size:null,height:e.layout==="vertical"&&e.label.size?e.label.size:null}},e.name||""));const u={row:!0,"field-group":!0,vertical:e.layout==="vertical"};return e.key&&(u[e.key]=!0),r("div",{class:u,style:{flex:e.height?"none":null,height:e.height?e.height:null}},a)}else if(e.type==="custom-row")return r("div",{class:"custom-row",style:{flex:e.height?"none":null,height:e.height?e.height:null}},h(e.children))})),c=k(),n=["clearValidate","resetFields","validate","validateFields"],f={};return n.forEach(t=>{t==="validate"||t==="validateFields"?f[t]=(...l)=>{const e=c.value?c.value[t](...l):Promise.resolve(),a=p.map(u=>u.value&&u.value.formRef?u.value.formRef[t](...l):Promise.resolve());return Promise.all([e,...a])}:f[t]=(...l)=>{c.value&&c.value[t](...l),p.forEach(e=>{e.value&&e.value.formRef&&e.value.formRef[t](...l)})}}),_(f),()=>{if(!s.schema||!s.model)return null;const t=z(s.schema);return r("div",{class:"alive-table"},r(q,{ref:c,autocomplete:"off",model:s.model,rules:s.rules},()=>t))}}});const le=V(ee,[["__scopeId","data-v-ef065f43"]]),te=k([{value:1,label:"男"},{value:2,label:"女"}]),ae=[{title:"起止年月",key:"date",editComp:{type:"input"}},{title:"工作单位",key:"company",editComp:{type:"input"}},{title:"担任职务",key:"duties",editComp:{type:"input"}},{title:"离职原因",key:"reason",editComp:{type:"input"}}],oe=[{type:"field-group",key:"personalInfo",layout:"horizontal",height:"50px",contentLayout:"horizontal",children:[{type:"field",key:"name",name:"姓名",layout:"horizontal",label:{type:"string",size:"150px"},value:{type:"input"}},{type:"field",key:"sex",name:"性别",layout:"horizontal",label:{type:"string",size:"150px"},value:{type:"select",compProps:{options:te.value}}},{type:"field",key:"age",name:"年龄",layout:"horizontal",label:{type:"string",size:"150px"},value:{type:"input-number",compProps:{min:16,max:65}}}]},{type:"field-group",key:"row2",layout:"horizontal",height:"200px",contentLayout:"horizontal",children:[{type:"field-group",key:"basicInfo",name:"基本信息",layout:"horizontal",label:{type:"string",size:"150px"},contentLayout:"vertical",children:[{type:"field",keyPath:"personalInfo.nativePlace",name:"籍贯",layout:"horizontal",label:{type:"string",size:"150px"},value:{type:"input"}},{type:"field",key:"marriage",keyPath:"personalInfo.marriage",name:"婚姻状况",layout:"horizontal",label:{type:"string",size:"150px"},value:{type:"select"}},{type:"field",keyPath:"personalInfo.idCard",name:"身份证号码",layout:"horizontal",label:{type:"string",size:"150px"},value:{type:"input"}},{type:"field",keyPath:"personalInfo.phone",name:"手机号码",layout:"horizontal",label:{type:"string",size:"150px"},value:{type:"input"}}]},{type:"field",key:"photo",name:"照片",layout:"horizontal",size:"150px",value:{type:"slot"}}]},{type:"field-group",key:"otherInfo",name:"其他信息",layout:"horizontal",height:"100px",label:{type:"string",size:"150px"},contentLayout:"float",children:[{type:"field",key:"job",name:"应聘职位",layout:"horizontal",width:"50%",height:"50%",label:{type:"string",size:"150px"},value:{type:"input"}},{type:"field",key:"address",name:"现住址",layout:"horizontal",width:"50%",height:"50%",label:{type:"string",size:"150px"},value:{type:"input"}},{type:"field",key:"interest",name:"兴趣爱好",layout:"horizontal",width:"50%",height:"50%",label:{type:"string",size:"150px"},value:{type:"input"}},{type:"field",key:"motto",name:"座右铭",layout:"horizontal",width:"50%",height:"50%",label:{type:"string",size:"150px"},value:{type:"input"}}]},{type:"field",key:"jobHistory",name:"工作经历",layout:"vertical",label:{type:"string",size:"50px"},value:{type:"editable-table",compProps:{columns:ae}}},{type:"custom-row",height:"100px",children:[{content:{type:"string",text:"欢迎"}},{content:{type:"string",text:"使用！"}},{key:"github",content:{type:"slot"}}]}],se=""+new URL("photo-3033e78d.jpeg",import.meta.url).href,ne={class:"demo-page"},re=["src"],ue=j("div",{class:"github"},[j("a",{href:"https://github.com/real-ju/alive-table",target:"_blank"},"前往官方仓库")],-1),ie={class:"action-area"},ye=L({__name:"index",setup(s){const _=k({personalInfo:{name:"",sex:1,age:20,nativePlace:"",marriage:void 0,idCard:"",phone:""},otherInfo:{job:"",address:"",interest:"",motto:""},jobHistory:(()=>{const c=[];for(let n=1;n<=3;n++)c.push({key:String(n),date:"",company:"",duties:"",reason:""});return c})()}),h=k({personalInfo:{name:[{required:!0,message:"请输入姓名"}],age:[{required:!0,message:"请输入年龄"}]},jobHistory:{date:[{required:!0,message:"请输入起止年月"}],company:[{required:!0,message:"请输入工作单位"}],duties:[{required:!0,message:"请输入担任职务"}]}}),p=k(),z=()=>{p.value.validate()};return(c,n)=>{const f=F("a-select-option"),t=F("a-button");return w(),S("div",ne,[v(b(le),{ref_key:"aliveTableRef",ref:p,schema:b(oe),model:_.value,"onUpdate:model":n[0]||(n[0]=l=>_.value=l),rules:h.value},{"field-photo-slot":i(()=>[j("img",{class:"photo",src:b(se),alt:"photo"},null,8,re)]),"field-marriage-comp-slot":i(()=>[v(f,{value:1},{default:i(()=>[x("未婚")]),_:1}),v(f,{value:2},{default:i(()=>[x("已婚")]),_:1}),v(f,{value:3},{default:i(()=>[x("离异")]),_:1}),v(f,{value:4},{default:i(()=>[x("丧偶")]),_:1})]),"custom-cell-github-slot":i(()=>[ue]),_:1},8,["schema","model","rules"]),j("div",ie,[v(t,{type:"primary",onClick:z},{default:i(()=>[x("验证表格")]),_:1})])])}}});export{ye as default};
